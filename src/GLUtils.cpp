/*
 *  GLUtils.cpp
 *  GaitSymODE
 *
 *  Created by Bill Sellers on 26/08/2005.
 *  Copyright 2005 Bill Sellers. All rights reserved.
 *
 */

#ifdef USE_QT

#include "GLUtils.h"

#include "StrokeFont.h"

// length of vector a
#define LENGTHOF(a) \
        sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])

#define LENGTH2OF(a) \
        (a[0]*a[0]+a[1]*a[1]+a[2]*a[2])

// Initialize static member of class GLUtils
StrokeFont *GLUtils::m_strokeFont = 0;

// Widget drawing routines

void
GLUtils::DrawAxes(float x, float y, float z, float ox, float oy, float oz)
{
    m_strokeFont->SetRGBA(1, 0, 0, 1);
    m_strokeFont->AddLine(x + ox, oy, oz, ox, oy, oz);
    m_strokeFont->SetRGBA(0, 1, 0, 1);
    m_strokeFont->AddLine(ox, y + oy, oz, ox, oy, oz);
    m_strokeFont->SetRGBA(0, 0, 1, 1);
    m_strokeFont->AddLine(ox, oy, z + oz, ox, oy, oz);
}

// write some 3D text at specified location x, y, z
void GLUtils::OutputText(float x, float y, float z, char *text, double size, const float *matrix, const float *translation)
{
    m_strokeFont->SetZ(z);
    m_strokeFont->StrokeString(
            text,          /* character string */
            strlen(text),  /* number of characters to draw */
            x,             /* x coordinate of bottom left of character */
            y,             /* y coordinate ... */
            size,          /* cwidth of character cell */
            size,          /* cheight of character cell */
            0,             /* 0 - left, 1 - centre, 2 - right */
            0,             /* 0 - bottom, 1 - centre, 2 - top */
            matrix, translation);
}

void GLUtils::DrawLine(float ix1, float iy1, float iz1, float ix2, float iy2, float iz2)
{
    m_strokeFont->AddLine(ix1, iy1, iz1, ix2, iy2, iz2);
}

void GLUtils::SetDrawColour(float r, float g, float b, float a)
{
    m_strokeFont->SetRGBA(r, g, b, a);
}

StrokeFont *GLUtils::strokeFont()
{
    return m_strokeFont;
}

void GLUtils::setStrokeFont(StrokeFont *strokeFont)
{
    m_strokeFont = strokeFont;
}

// set colour based on a colour map indexed from 0 to 1
// uses built in 256 element colour maps
void GLUtils::SetColourFromMap(float index, ColourMap m, Colour *mappedColour, bool invert)
{

    static float grey[256][4] =
    {
        {0,0,0,1},
        {0.003921569,0.003921569,0.003921569,1},
        {0.007843137,0.007843137,0.007843137,1},
        {0.011764706,0.011764706,0.011764706,1},
        {0.015686275,0.015686275,0.015686275,1},
        {0.019607843,0.019607843,0.019607843,1},
        {0.023529412,0.023529412,0.023529412,1},
        {0.02745098,0.02745098,0.02745098,1},
        {0.031372549,0.031372549,0.031372549,1},
        {0.035294118,0.035294118,0.035294118,1},
        {0.039215686,0.039215686,0.039215686,1},
        {0.043137255,0.043137255,0.043137255,1},
        {0.047058824,0.047058824,0.047058824,1},
        {0.050980392,0.050980392,0.050980392,1},
        {0.054901961,0.054901961,0.054901961,1},
        {0.058823529,0.058823529,0.058823529,1},
        {0.062745098,0.062745098,0.062745098,1},
        {0.066666667,0.066666667,0.066666667,1},
        {0.070588235,0.070588235,0.070588235,1},
        {0.074509804,0.074509804,0.074509804,1},
        {0.078431373,0.078431373,0.078431373,1},
        {0.082352941,0.082352941,0.082352941,1},
        {0.08627451,0.08627451,0.08627451,1},
        {0.090196078,0.090196078,0.090196078,1},
        {0.094117647,0.094117647,0.094117647,1},
        {0.098039216,0.098039216,0.098039216,1},
        {0.101960784,0.101960784,0.101960784,1},
        {0.105882353,0.105882353,0.105882353,1},
        {0.109803922,0.109803922,0.109803922,1},
        {0.11372549,0.11372549,0.11372549,1},
        {0.117647059,0.117647059,0.117647059,1},
        {0.121568627,0.121568627,0.121568627,1},
        {0.125490196,0.125490196,0.125490196,1},
        {0.129411765,0.129411765,0.129411765,1},
        {0.133333333,0.133333333,0.133333333,1},
        {0.137254902,0.137254902,0.137254902,1},
        {0.141176471,0.141176471,0.141176471,1},
        {0.145098039,0.145098039,0.145098039,1},
        {0.149019608,0.149019608,0.149019608,1},
        {0.152941176,0.152941176,0.152941176,1},
        {0.156862745,0.156862745,0.156862745,1},
        {0.160784314,0.160784314,0.160784314,1},
        {0.164705882,0.164705882,0.164705882,1},
        {0.168627451,0.168627451,0.168627451,1},
        {0.17254902,0.17254902,0.17254902,1},
        {0.176470588,0.176470588,0.176470588,1},
        {0.180392157,0.180392157,0.180392157,1},
        {0.184313725,0.184313725,0.184313725,1},
        {0.188235294,0.188235294,0.188235294,1},
        {0.192156863,0.192156863,0.192156863,1},
        {0.196078431,0.196078431,0.196078431,1},
        {0.2,0.2,0.2,1},
        {0.203921569,0.203921569,0.203921569,1},
        {0.207843137,0.207843137,0.207843137,1},
        {0.211764706,0.211764706,0.211764706,1},
        {0.215686275,0.215686275,0.215686275,1},
        {0.219607843,0.219607843,0.219607843,1},
        {0.223529412,0.223529412,0.223529412,1},
        {0.22745098,0.22745098,0.22745098,1},
        {0.231372549,0.231372549,0.231372549,1},
        {0.235294118,0.235294118,0.235294118,1},
        {0.239215686,0.239215686,0.239215686,1},
        {0.243137255,0.243137255,0.243137255,1},
        {0.247058824,0.247058824,0.247058824,1},
        {0.250980392,0.250980392,0.250980392,1},
        {0.254901961,0.254901961,0.254901961,1},
        {0.258823529,0.258823529,0.258823529,1},
        {0.262745098,0.262745098,0.262745098,1},
        {0.266666667,0.266666667,0.266666667,1},
        {0.270588235,0.270588235,0.270588235,1},
        {0.274509804,0.274509804,0.274509804,1},
        {0.278431373,0.278431373,0.278431373,1},
        {0.282352941,0.282352941,0.282352941,1},
        {0.28627451,0.28627451,0.28627451,1},
        {0.290196078,0.290196078,0.290196078,1},
        {0.294117647,0.294117647,0.294117647,1},
        {0.298039216,0.298039216,0.298039216,1},
        {0.301960784,0.301960784,0.301960784,1},
        {0.305882353,0.305882353,0.305882353,1},
        {0.309803922,0.309803922,0.309803922,1},
        {0.31372549,0.31372549,0.31372549,1},
        {0.317647059,0.317647059,0.317647059,1},
        {0.321568627,0.321568627,0.321568627,1},
        {0.325490196,0.325490196,0.325490196,1},
        {0.329411765,0.329411765,0.329411765,1},
        {0.333333333,0.333333333,0.333333333,1},
        {0.337254902,0.337254902,0.337254902,1},
        {0.341176471,0.341176471,0.341176471,1},
        {0.345098039,0.345098039,0.345098039,1},
        {0.349019608,0.349019608,0.349019608,1},
        {0.352941176,0.352941176,0.352941176,1},
        {0.356862745,0.356862745,0.356862745,1},
        {0.360784314,0.360784314,0.360784314,1},
        {0.364705882,0.364705882,0.364705882,1},
        {0.368627451,0.368627451,0.368627451,1},
        {0.37254902,0.37254902,0.37254902,1},
        {0.376470588,0.376470588,0.376470588,1},
        {0.380392157,0.380392157,0.380392157,1},
        {0.384313725,0.384313725,0.384313725,1},
        {0.388235294,0.388235294,0.388235294,1},
        {0.392156863,0.392156863,0.392156863,1},
        {0.396078431,0.396078431,0.396078431,1},
        {0.4,0.4,0.4,1},
        {0.403921569,0.403921569,0.403921569,1},
        {0.407843137,0.407843137,0.407843137,1},
        {0.411764706,0.411764706,0.411764706,1},
        {0.415686275,0.415686275,0.415686275,1},
        {0.419607843,0.419607843,0.419607843,1},
        {0.423529412,0.423529412,0.423529412,1},
        {0.42745098,0.42745098,0.42745098,1},
        {0.431372549,0.431372549,0.431372549,1},
        {0.435294118,0.435294118,0.435294118,1},
        {0.439215686,0.439215686,0.439215686,1},
        {0.443137255,0.443137255,0.443137255,1},
        {0.447058824,0.447058824,0.447058824,1},
        {0.450980392,0.450980392,0.450980392,1},
        {0.454901961,0.454901961,0.454901961,1},
        {0.458823529,0.458823529,0.458823529,1},
        {0.462745098,0.462745098,0.462745098,1},
        {0.466666667,0.466666667,0.466666667,1},
        {0.470588235,0.470588235,0.470588235,1},
        {0.474509804,0.474509804,0.474509804,1},
        {0.478431373,0.478431373,0.478431373,1},
        {0.482352941,0.482352941,0.482352941,1},
        {0.48627451,0.48627451,0.48627451,1},
        {0.490196078,0.490196078,0.490196078,1},
        {0.494117647,0.494117647,0.494117647,1},
        {0.498039216,0.498039216,0.498039216,1},
        {0.501960784,0.501960784,0.501960784,1},
        {0.505882353,0.505882353,0.505882353,1},
        {0.509803922,0.509803922,0.509803922,1},
        {0.51372549,0.51372549,0.51372549,1},
        {0.517647059,0.517647059,0.517647059,1},
        {0.521568627,0.521568627,0.521568627,1},
        {0.525490196,0.525490196,0.525490196,1},
        {0.529411765,0.529411765,0.529411765,1},
        {0.533333333,0.533333333,0.533333333,1},
        {0.537254902,0.537254902,0.537254902,1},
        {0.541176471,0.541176471,0.541176471,1},
        {0.545098039,0.545098039,0.545098039,1},
        {0.549019608,0.549019608,0.549019608,1},
        {0.552941176,0.552941176,0.552941176,1},
        {0.556862745,0.556862745,0.556862745,1},
        {0.560784314,0.560784314,0.560784314,1},
        {0.564705882,0.564705882,0.564705882,1},
        {0.568627451,0.568627451,0.568627451,1},
        {0.57254902,0.57254902,0.57254902,1},
        {0.576470588,0.576470588,0.576470588,1},
        {0.580392157,0.580392157,0.580392157,1},
        {0.584313725,0.584313725,0.584313725,1},
        {0.588235294,0.588235294,0.588235294,1},
        {0.592156863,0.592156863,0.592156863,1},
        {0.596078431,0.596078431,0.596078431,1},
        {0.6,0.6,0.6,1},
        {0.603921569,0.603921569,0.603921569,1},
        {0.607843137,0.607843137,0.607843137,1},
        {0.611764706,0.611764706,0.611764706,1},
        {0.615686275,0.615686275,0.615686275,1},
        {0.619607843,0.619607843,0.619607843,1},
        {0.623529412,0.623529412,0.623529412,1},
        {0.62745098,0.62745098,0.62745098,1},
        {0.631372549,0.631372549,0.631372549,1},
        {0.635294118,0.635294118,0.635294118,1},
        {0.639215686,0.639215686,0.639215686,1},
        {0.643137255,0.643137255,0.643137255,1},
        {0.647058824,0.647058824,0.647058824,1},
        {0.650980392,0.650980392,0.650980392,1},
        {0.654901961,0.654901961,0.654901961,1},
        {0.658823529,0.658823529,0.658823529,1},
        {0.662745098,0.662745098,0.662745098,1},
        {0.666666667,0.666666667,0.666666667,1},
        {0.670588235,0.670588235,0.670588235,1},
        {0.674509804,0.674509804,0.674509804,1},
        {0.678431373,0.678431373,0.678431373,1},
        {0.682352941,0.682352941,0.682352941,1},
        {0.68627451,0.68627451,0.68627451,1},
        {0.690196078,0.690196078,0.690196078,1},
        {0.694117647,0.694117647,0.694117647,1},
        {0.698039216,0.698039216,0.698039216,1},
        {0.701960784,0.701960784,0.701960784,1},
        {0.705882353,0.705882353,0.705882353,1},
        {0.709803922,0.709803922,0.709803922,1},
        {0.71372549,0.71372549,0.71372549,1},
        {0.717647059,0.717647059,0.717647059,1},
        {0.721568627,0.721568627,0.721568627,1},
        {0.725490196,0.725490196,0.725490196,1},
        {0.729411765,0.729411765,0.729411765,1},
        {0.733333333,0.733333333,0.733333333,1},
        {0.737254902,0.737254902,0.737254902,1},
        {0.741176471,0.741176471,0.741176471,1},
        {0.745098039,0.745098039,0.745098039,1},
        {0.749019608,0.749019608,0.749019608,1},
        {0.752941176,0.752941176,0.752941176,1},
        {0.756862745,0.756862745,0.756862745,1},
        {0.760784314,0.760784314,0.760784314,1},
        {0.764705882,0.764705882,0.764705882,1},
        {0.768627451,0.768627451,0.768627451,1},
        {0.77254902,0.77254902,0.77254902,1},
        {0.776470588,0.776470588,0.776470588,1},
        {0.780392157,0.780392157,0.780392157,1},
        {0.784313725,0.784313725,0.784313725,1},
        {0.788235294,0.788235294,0.788235294,1},
        {0.792156863,0.792156863,0.792156863,1},
        {0.796078431,0.796078431,0.796078431,1},
        {0.8,0.8,0.8,1},
        {0.803921569,0.803921569,0.803921569,1},
        {0.807843137,0.807843137,0.807843137,1},
        {0.811764706,0.811764706,0.811764706,1},
        {0.815686275,0.815686275,0.815686275,1},
        {0.819607843,0.819607843,0.819607843,1},
        {0.823529412,0.823529412,0.823529412,1},
        {0.82745098,0.82745098,0.82745098,1},
        {0.831372549,0.831372549,0.831372549,1},
        {0.835294118,0.835294118,0.835294118,1},
        {0.839215686,0.839215686,0.839215686,1},
        {0.843137255,0.843137255,0.843137255,1},
        {0.847058824,0.847058824,0.847058824,1},
        {0.850980392,0.850980392,0.850980392,1},
        {0.854901961,0.854901961,0.854901961,1},
        {0.858823529,0.858823529,0.858823529,1},
        {0.862745098,0.862745098,0.862745098,1},
        {0.866666667,0.866666667,0.866666667,1},
        {0.870588235,0.870588235,0.870588235,1},
        {0.874509804,0.874509804,0.874509804,1},
        {0.878431373,0.878431373,0.878431373,1},
        {0.882352941,0.882352941,0.882352941,1},
        {0.88627451,0.88627451,0.88627451,1},
        {0.890196078,0.890196078,0.890196078,1},
        {0.894117647,0.894117647,0.894117647,1},
        {0.898039216,0.898039216,0.898039216,1},
        {0.901960784,0.901960784,0.901960784,1},
        {0.905882353,0.905882353,0.905882353,1},
        {0.909803922,0.909803922,0.909803922,1},
        {0.91372549,0.91372549,0.91372549,1},
        {0.917647059,0.917647059,0.917647059,1},
        {0.921568627,0.921568627,0.921568627,1},
        {0.925490196,0.925490196,0.925490196,1},
        {0.929411765,0.929411765,0.929411765,1},
        {0.933333333,0.933333333,0.933333333,1},
        {0.937254902,0.937254902,0.937254902,1},
        {0.941176471,0.941176471,0.941176471,1},
        {0.945098039,0.945098039,0.945098039,1},
        {0.949019608,0.949019608,0.949019608,1},
        {0.952941176,0.952941176,0.952941176,1},
        {0.956862745,0.956862745,0.956862745,1},
        {0.960784314,0.960784314,0.960784314,1},
        {0.964705882,0.964705882,0.964705882,1},
        {0.968627451,0.968627451,0.968627451,1},
        {0.97254902,0.97254902,0.97254902,1},
        {0.976470588,0.976470588,0.976470588,1},
        {0.980392157,0.980392157,0.980392157,1},
        {0.984313725,0.984313725,0.984313725,1},
        {0.988235294,0.988235294,0.988235294,1},
        {0.992156863,0.992156863,0.992156863,1},
        {0.996078431,0.996078431,0.996078431,1},
        {1,1,1,1}
    };
    static float cool[256][4] =
    {
        {0,1,1,1},
        {0.0039216,0.99608,1,1},
        {0.0078431,0.99216,1,1},
        {0.011765,0.98824,1,1},
        {0.015686,0.98431,1,1},
        {0.019608,0.98039,1,1},
        {0.023529,0.97647,1,1},
        {0.027451,0.97255,1,1},
        {0.031373,0.96863,1,1},
        {0.035294,0.96471,1,1},
        {0.039216,0.96078,1,1},
        {0.043137,0.95686,1,1},
        {0.047059,0.95294,1,1},
        {0.05098,0.94902,1,1},
        {0.054902,0.9451,1,1},
        {0.058824,0.94118,1,1},
        {0.062745,0.93725,1,1},
        {0.066667,0.93333,1,1},
        {0.070588,0.92941,1,1},
        {0.07451,0.92549,1,1},
        {0.078431,0.92157,1,1},
        {0.082353,0.91765,1,1},
        {0.086275,0.91373,1,1},
        {0.090196,0.9098,1,1},
        {0.094118,0.90588,1,1},
        {0.098039,0.90196,1,1},
        {0.10196,0.89804,1,1},
        {0.10588,0.89412,1,1},
        {0.1098,0.8902,1,1},
        {0.11373,0.88627,1,1},
        {0.11765,0.88235,1,1},
        {0.12157,0.87843,1,1},
        {0.12549,0.87451,1,1},
        {0.12941,0.87059,1,1},
        {0.13333,0.86667,1,1},
        {0.13725,0.86275,1,1},
        {0.14118,0.85882,1,1},
        {0.1451,0.8549,1,1},
        {0.14902,0.85098,1,1},
        {0.15294,0.84706,1,1},
        {0.15686,0.84314,1,1},
        {0.16078,0.83922,1,1},
        {0.16471,0.83529,1,1},
        {0.16863,0.83137,1,1},
        {0.17255,0.82745,1,1},
        {0.17647,0.82353,1,1},
        {0.18039,0.81961,1,1},
        {0.18431,0.81569,1,1},
        {0.18824,0.81176,1,1},
        {0.19216,0.80784,1,1},
        {0.19608,0.80392,1,1},
        {0.2,0.8,1,1},
        {0.20392,0.79608,1,1},
        {0.20784,0.79216,1,1},
        {0.21176,0.78824,1,1},
        {0.21569,0.78431,1,1},
        {0.21961,0.78039,1,1},
        {0.22353,0.77647,1,1},
        {0.22745,0.77255,1,1},
        {0.23137,0.76863,1,1},
        {0.23529,0.76471,1,1},
        {0.23922,0.76078,1,1},
        {0.24314,0.75686,1,1},
        {0.24706,0.75294,1,1},
        {0.25098,0.74902,1,1},
        {0.2549,0.7451,1,1},
        {0.25882,0.74118,1,1},
        {0.26275,0.73725,1,1},
        {0.26667,0.73333,1,1},
        {0.27059,0.72941,1,1},
        {0.27451,0.72549,1,1},
        {0.27843,0.72157,1,1},
        {0.28235,0.71765,1,1},
        {0.28627,0.71373,1,1},
        {0.2902,0.7098,1,1},
        {0.29412,0.70588,1,1},
        {0.29804,0.70196,1,1},
        {0.30196,0.69804,1,1},
        {0.30588,0.69412,1,1},
        {0.3098,0.6902,1,1},
        {0.31373,0.68627,1,1},
        {0.31765,0.68235,1,1},
        {0.32157,0.67843,1,1},
        {0.32549,0.67451,1,1},
        {0.32941,0.67059,1,1},
        {0.33333,0.66667,1,1},
        {0.33725,0.66275,1,1},
        {0.34118,0.65882,1,1},
        {0.3451,0.6549,1,1},
        {0.34902,0.65098,1,1},
        {0.35294,0.64706,1,1},
        {0.35686,0.64314,1,1},
        {0.36078,0.63922,1,1},
        {0.36471,0.63529,1,1},
        {0.36863,0.63137,1,1},
        {0.37255,0.62745,1,1},
        {0.37647,0.62353,1,1},
        {0.38039,0.61961,1,1},
        {0.38431,0.61569,1,1},
        {0.38824,0.61176,1,1},
        {0.39216,0.60784,1,1},
        {0.39608,0.60392,1,1},
        {0.4,0.6,1,1},
        {0.40392,0.59608,1,1},
        {0.40784,0.59216,1,1},
        {0.41176,0.58824,1,1},
        {0.41569,0.58431,1,1},
        {0.41961,0.58039,1,1},
        {0.42353,0.57647,1,1},
        {0.42745,0.57255,1,1},
        {0.43137,0.56863,1,1},
        {0.43529,0.56471,1,1},
        {0.43922,0.56078,1,1},
        {0.44314,0.55686,1,1},
        {0.44706,0.55294,1,1},
        {0.45098,0.54902,1,1},
        {0.4549,0.5451,1,1},
        {0.45882,0.54118,1,1},
        {0.46275,0.53725,1,1},
        {0.46667,0.53333,1,1},
        {0.47059,0.52941,1,1},
        {0.47451,0.52549,1,1},
        {0.47843,0.52157,1,1},
        {0.48235,0.51765,1,1},
        {0.48627,0.51373,1,1},
        {0.4902,0.5098,1,1},
        {0.49412,0.50588,1,1},
        {0.49804,0.50196,1,1},
        {0.50196,0.49804,1,1},
        {0.50588,0.49412,1,1},
        {0.5098,0.4902,1,1},
        {0.51373,0.48627,1,1},
        {0.51765,0.48235,1,1},
        {0.52157,0.47843,1,1},
        {0.52549,0.47451,1,1},
        {0.52941,0.47059,1,1},
        {0.53333,0.46667,1,1},
        {0.53725,0.46275,1,1},
        {0.54118,0.45882,1,1},
        {0.5451,0.4549,1,1},
        {0.54902,0.45098,1,1},
        {0.55294,0.44706,1,1},
        {0.55686,0.44314,1,1},
        {0.56078,0.43922,1,1},
        {0.56471,0.43529,1,1},
        {0.56863,0.43137,1,1},
        {0.57255,0.42745,1,1},
        {0.57647,0.42353,1,1},
        {0.58039,0.41961,1,1},
        {0.58431,0.41569,1,1},
        {0.58824,0.41176,1,1},
        {0.59216,0.40784,1,1},
        {0.59608,0.40392,1,1},
        {0.6,0.4,1,1},
        {0.60392,0.39608,1,1},
        {0.60784,0.39216,1,1},
        {0.61176,0.38824,1,1},
        {0.61569,0.38431,1,1},
        {0.61961,0.38039,1,1},
        {0.62353,0.37647,1,1},
        {0.62745,0.37255,1,1},
        {0.63137,0.36863,1,1},
        {0.63529,0.36471,1,1},
        {0.63922,0.36078,1,1},
        {0.64314,0.35686,1,1},
        {0.64706,0.35294,1,1},
        {0.65098,0.34902,1,1},
        {0.6549,0.3451,1,1},
        {0.65882,0.34118,1,1},
        {0.66275,0.33725,1,1},
        {0.66667,0.33333,1,1},
        {0.67059,0.32941,1,1},
        {0.67451,0.32549,1,1},
        {0.67843,0.32157,1,1},
        {0.68235,0.31765,1,1},
        {0.68627,0.31373,1,1},
        {0.6902,0.3098,1,1},
        {0.69412,0.30588,1,1},
        {0.69804,0.30196,1,1},
        {0.70196,0.29804,1,1},
        {0.70588,0.29412,1,1},
        {0.7098,0.2902,1,1},
        {0.71373,0.28627,1,1},
        {0.71765,0.28235,1,1},
        {0.72157,0.27843,1,1},
        {0.72549,0.27451,1,1},
        {0.72941,0.27059,1,1},
        {0.73333,0.26667,1,1},
        {0.73725,0.26275,1,1},
        {0.74118,0.25882,1,1},
        {0.7451,0.2549,1,1},
        {0.74902,0.25098,1,1},
        {0.75294,0.24706,1,1},
        {0.75686,0.24314,1,1},
        {0.76078,0.23922,1,1},
        {0.76471,0.23529,1,1},
        {0.76863,0.23137,1,1},
        {0.77255,0.22745,1,1},
        {0.77647,0.22353,1,1},
        {0.78039,0.21961,1,1},
        {0.78431,0.21569,1,1},
        {0.78824,0.21176,1,1},
        {0.79216,0.20784,1,1},
        {0.79608,0.20392,1,1},
        {0.8,0.2,1,1},
        {0.80392,0.19608,1,1},
        {0.80784,0.19216,1,1},
        {0.81176,0.18824,1,1},
        {0.81569,0.18431,1,1},
        {0.81961,0.18039,1,1},
        {0.82353,0.17647,1,1},
        {0.82745,0.17255,1,1},
        {0.83137,0.16863,1,1},
        {0.83529,0.16471,1,1},
        {0.83922,0.16078,1,1},
        {0.84314,0.15686,1,1},
        {0.84706,0.15294,1,1},
        {0.85098,0.14902,1,1},
        {0.8549,0.1451,1,1},
        {0.85882,0.14118,1,1},
        {0.86275,0.13725,1,1},
        {0.86667,0.13333,1,1},
        {0.87059,0.12941,1,1},
        {0.87451,0.12549,1,1},
        {0.87843,0.12157,1,1},
        {0.88235,0.11765,1,1},
        {0.88627,0.11373,1,1},
        {0.8902,0.1098,1,1},
        {0.89412,0.10588,1,1},
        {0.89804,0.10196,1,1},
        {0.90196,0.098039,1,1},
        {0.90588,0.094118,1,1},
        {0.9098,0.090196,1,1},
        {0.91373,0.086275,1,1},
        {0.91765,0.082353,1,1},
        {0.92157,0.078431,1,1},
        {0.92549,0.07451,1,1},
        {0.92941,0.070588,1,1},
        {0.93333,0.066667,1,1},
        {0.93725,0.062745,1,1},
        {0.94118,0.058824,1,1},
        {0.9451,0.054902,1,1},
        {0.94902,0.05098,1,1},
        {0.95294,0.047059,1,1},
        {0.95686,0.043137,1,1},
        {0.96078,0.039216,1,1},
        {0.96471,0.035294,1,1},
        {0.96863,0.031373,1,1},
        {0.97255,0.027451,1,1},
        {0.97647,0.023529,1,1},
        {0.98039,0.019608,1,1},
        {0.98431,0.015686,1,1},
        {0.98824,0.011765,1,1},
        {0.99216,0.0078431,1,1},
        {0.99608,0.0039216,1,1},
        {1,0,1,1}
    };
    static float hot[256][4] =
    {
        {0.010417,0,0,1},
        {0.020833,0,0,1},
        {0.03125,0,0,1},
        {0.041667,0,0,1},
        {0.052083,0,0,1},
        {0.0625,0,0,1},
        {0.072917,0,0,1},
        {0.083333,0,0,1},
        {0.09375,0,0,1},
        {0.10417,0,0,1},
        {0.11458,0,0,1},
        {0.125,0,0,1},
        {0.13542,0,0,1},
        {0.14583,0,0,1},
        {0.15625,0,0,1},
        {0.16667,0,0,1},
        {0.17708,0,0,1},
        {0.1875,0,0,1},
        {0.19792,0,0,1},
        {0.20833,0,0,1},
        {0.21875,0,0,1},
        {0.22917,0,0,1},
        {0.23958,0,0,1},
        {0.25,0,0,1},
        {0.26042,0,0,1},
        {0.27083,0,0,1},
        {0.28125,0,0,1},
        {0.29167,0,0,1},
        {0.30208,0,0,1},
        {0.3125,0,0,1},
        {0.32292,0,0,1},
        {0.33333,0,0,1},
        {0.34375,0,0,1},
        {0.35417,0,0,1},
        {0.36458,0,0,1},
        {0.375,0,0,1},
        {0.38542,0,0,1},
        {0.39583,0,0,1},
        {0.40625,0,0,1},
        {0.41667,0,0,1},
        {0.42708,0,0,1},
        {0.4375,0,0,1},
        {0.44792,0,0,1},
        {0.45833,0,0,1},
        {0.46875,0,0,1},
        {0.47917,0,0,1},
        {0.48958,0,0,1},
        {0.5,0,0,1},
        {0.51042,0,0,1},
        {0.52083,0,0,1},
        {0.53125,0,0,1},
        {0.54167,0,0,1},
        {0.55208,0,0,1},
        {0.5625,0,0,1},
        {0.57292,0,0,1},
        {0.58333,0,0,1},
        {0.59375,0,0,1},
        {0.60417,0,0,1},
        {0.61458,0,0,1},
        {0.625,0,0,1},
        {0.63542,0,0,1},
        {0.64583,0,0,1},
        {0.65625,0,0,1},
        {0.66667,0,0,1},
        {0.67708,0,0,1},
        {0.6875,0,0,1},
        {0.69792,0,0,1},
        {0.70833,0,0,1},
        {0.71875,0,0,1},
        {0.72917,0,0,1},
        {0.73958,0,0,1},
        {0.75,0,0,1},
        {0.76042,0,0,1},
        {0.77083,0,0,1},
        {0.78125,0,0,1},
        {0.79167,0,0,1},
        {0.80208,0,0,1},
        {0.8125,0,0,1},
        {0.82292,0,0,1},
        {0.83333,0,0,1},
        {0.84375,0,0,1},
        {0.85417,0,0,1},
        {0.86458,0,0,1},
        {0.875,0,0,1},
        {0.88542,0,0,1},
        {0.89583,0,0,1},
        {0.90625,0,0,1},
        {0.91667,0,0,1},
        {0.92708,0,0,1},
        {0.9375,0,0,1},
        {0.94792,0,0,1},
        {0.95833,0,0,1},
        {0.96875,0,0,1},
        {0.97917,0,0,1},
        {0.98958,0,0,1},
        {1,0,0,1},
        {1,0.010417,0,1},
        {1,0.020833,0,1},
        {1,0.03125,0,1},
        {1,0.041667,0,1},
        {1,0.052083,0,1},
        {1,0.0625,0,1},
        {1,0.072917,0,1},
        {1,0.083333,0,1},
        {1,0.09375,0,1},
        {1,0.10417,0,1},
        {1,0.11458,0,1},
        {1,0.125,0,1},
        {1,0.13542,0,1},
        {1,0.14583,0,1},
        {1,0.15625,0,1},
        {1,0.16667,0,1},
        {1,0.17708,0,1},
        {1,0.1875,0,1},
        {1,0.19792,0,1},
        {1,0.20833,0,1},
        {1,0.21875,0,1},
        {1,0.22917,0,1},
        {1,0.23958,0,1},
        {1,0.25,0,1},
        {1,0.26042,0,1},
        {1,0.27083,0,1},
        {1,0.28125,0,1},
        {1,0.29167,0,1},
        {1,0.30208,0,1},
        {1,0.3125,0,1},
        {1,0.32292,0,1},
        {1,0.33333,0,1},
        {1,0.34375,0,1},
        {1,0.35417,0,1},
        {1,0.36458,0,1},
        {1,0.375,0,1},
        {1,0.38542,0,1},
        {1,0.39583,0,1},
        {1,0.40625,0,1},
        {1,0.41667,0,1},
        {1,0.42708,0,1},
        {1,0.4375,0,1},
        {1,0.44792,0,1},
        {1,0.45833,0,1},
        {1,0.46875,0,1},
        {1,0.47917,0,1},
        {1,0.48958,0,1},
        {1,0.5,0,1},
        {1,0.51042,0,1},
        {1,0.52083,0,1},
        {1,0.53125,0,1},
        {1,0.54167,0,1},
        {1,0.55208,0,1},
        {1,0.5625,0,1},
        {1,0.57292,0,1},
        {1,0.58333,0,1},
        {1,0.59375,0,1},
        {1,0.60417,0,1},
        {1,0.61458,0,1},
        {1,0.625,0,1},
        {1,0.63542,0,1},
        {1,0.64583,0,1},
        {1,0.65625,0,1},
        {1,0.66667,0,1},
        {1,0.67708,0,1},
        {1,0.6875,0,1},
        {1,0.69792,0,1},
        {1,0.70833,0,1},
        {1,0.71875,0,1},
        {1,0.72917,0,1},
        {1,0.73958,0,1},
        {1,0.75,0,1},
        {1,0.76042,0,1},
        {1,0.77083,0,1},
        {1,0.78125,0,1},
        {1,0.79167,0,1},
        {1,0.80208,0,1},
        {1,0.8125,0,1},
        {1,0.82292,0,1},
        {1,0.83333,0,1},
        {1,0.84375,0,1},
        {1,0.85417,0,1},
        {1,0.86458,0,1},
        {1,0.875,0,1},
        {1,0.88542,0,1},
        {1,0.89583,0,1},
        {1,0.90625,0,1},
        {1,0.91667,0,1},
        {1,0.92708,0,1},
        {1,0.9375,0,1},
        {1,0.94792,0,1},
        {1,0.95833,0,1},
        {1,0.96875,0,1},
        {1,0.97917,0,1},
        {1,0.98958,0,1},
        {1,1,0,1},
        {1,1,0.015625,1},
        {1,1,0.03125,1},
        {1,1,0.046875,1},
        {1,1,0.0625,1},
        {1,1,0.078125,1},
        {1,1,0.09375,1},
        {1,1,0.10938,1},
        {1,1,0.125,1},
        {1,1,0.14062,1},
        {1,1,0.15625,1},
        {1,1,0.17188,1},
        {1,1,0.1875,1},
        {1,1,0.20312,1},
        {1,1,0.21875,1},
        {1,1,0.23438,1},
        {1,1,0.25,1},
        {1,1,0.26562,1},
        {1,1,0.28125,1},
        {1,1,0.29688,1},
        {1,1,0.3125,1},
        {1,1,0.32812,1},
        {1,1,0.34375,1},
        {1,1,0.35938,1},
        {1,1,0.375,1},
        {1,1,0.39062,1},
        {1,1,0.40625,1},
        {1,1,0.42188,1},
        {1,1,0.4375,1},
        {1,1,0.45312,1},
        {1,1,0.46875,1},
        {1,1,0.48438,1},
        {1,1,0.5,1},
        {1,1,0.51562,1},
        {1,1,0.53125,1},
        {1,1,0.54688,1},
        {1,1,0.5625,1},
        {1,1,0.57812,1},
        {1,1,0.59375,1},
        {1,1,0.60938,1},
        {1,1,0.625,1},
        {1,1,0.64062,1},
        {1,1,0.65625,1},
        {1,1,0.67188,1},
        {1,1,0.6875,1},
        {1,1,0.70312,1},
        {1,1,0.71875,1},
        {1,1,0.73438,1},
        {1,1,0.75,1},
        {1,1,0.76562,1},
        {1,1,0.78125,1},
        {1,1,0.79688,1},
        {1,1,0.8125,1},
        {1,1,0.82812,1},
        {1,1,0.84375,1},
        {1,1,0.85938,1},
        {1,1,0.875,1},
        {1,1,0.89062,1},
        {1,1,0.90625,1},
        {1,1,0.92188,1},
        {1,1,0.9375,1},
        {1,1,0.95312,1},
        {1,1,0.96875,1},
        {1,1,0.98438,1},
        {1,1,1,1}
    };
    static float hsv[256][4] =
    {
        {1,0,0,1},
        {1,0.023438,0,1},
        {1,0.046875,0,1},
        {1,0.070312,0,1},
        {1,0.09375,0,1},
        {1,0.11719,0,1},
        {1,0.14062,0,1},
        {1,0.16406,0,1},
        {1,0.1875,0,1},
        {1,0.21094,0,1},
        {1,0.23438,0,1},
        {1,0.25781,0,1},
        {1,0.28125,0,1},
        {1,0.30469,0,1},
        {1,0.32812,0,1},
        {1,0.35156,0,1},
        {1,0.375,0,1},
        {1,0.39844,0,1},
        {1,0.42188,0,1},
        {1,0.44531,0,1},
        {1,0.46875,0,1},
        {1,0.49219,0,1},
        {1,0.51562,0,1},
        {1,0.53906,0,1},
        {1,0.5625,0,1},
        {1,0.58594,0,1},
        {1,0.60938,0,1},
        {1,0.63281,0,1},
        {1,0.65625,0,1},
        {1,0.67969,0,1},
        {1,0.70312,0,1},
        {1,0.72656,0,1},
        {1,0.75,0,1},
        {1,0.77344,0,1},
        {1,0.79688,0,1},
        {1,0.82031,0,1},
        {1,0.84375,0,1},
        {1,0.86719,0,1},
        {1,0.89062,0,1},
        {1,0.91406,0,1},
        {1,0.9375,0,1},
        {1,0.96094,0,1},
        {1,0.98438,0,1},
        {0.99219,1,0,1},
        {0.96875,1,0,1},
        {0.94531,1,0,1},
        {0.92188,1,0,1},
        {0.89844,1,0,1},
        {0.875,1,0,1},
        {0.85156,1,0,1},
        {0.82812,1,0,1},
        {0.80469,1,0,1},
        {0.78125,1,0,1},
        {0.75781,1,0,1},
        {0.73438,1,0,1},
        {0.71094,1,0,1},
        {0.6875,1,0,1},
        {0.66406,1,0,1},
        {0.64062,1,0,1},
        {0.61719,1,0,1},
        {0.59375,1,0,1},
        {0.57031,1,0,1},
        {0.54688,1,0,1},
        {0.52344,1,0,1},
        {0.5,1,0,1},
        {0.47656,1,0,1},
        {0.45312,1,0,1},
        {0.42969,1,0,1},
        {0.40625,1,0,1},
        {0.38281,1,0,1},
        {0.35938,1,0,1},
        {0.33594,1,0,1},
        {0.3125,1,0,1},
        {0.28906,1,0,1},
        {0.26562,1,0,1},
        {0.24219,1,0,1},
        {0.21875,1,0,1},
        {0.19531,1,0,1},
        {0.17188,1,0,1},
        {0.14844,1,0,1},
        {0.125,1,0,1},
        {0.10156,1,0,1},
        {0.078125,1,0,1},
        {0.054688,1,0,1},
        {0.03125,1,0,1},
        {0.0078125,1,0,1},
        {0,1,0.015625,1},
        {0,1,0.039062,1},
        {0,1,0.0625,1},
        {0,1,0.085938,1},
        {0,1,0.10938,1},
        {0,1,0.13281,1},
        {0,1,0.15625,1},
        {0,1,0.17969,1},
        {0,1,0.20312,1},
        {0,1,0.22656,1},
        {0,1,0.25,1},
        {0,1,0.27344,1},
        {0,1,0.29688,1},
        {0,1,0.32031,1},
        {0,1,0.34375,1},
        {0,1,0.36719,1},
        {0,1,0.39062,1},
        {0,1,0.41406,1},
        {0,1,0.4375,1},
        {0,1,0.46094,1},
        {0,1,0.48438,1},
        {0,1,0.50781,1},
        {0,1,0.53125,1},
        {0,1,0.55469,1},
        {0,1,0.57812,1},
        {0,1,0.60156,1},
        {0,1,0.625,1},
        {0,1,0.64844,1},
        {0,1,0.67188,1},
        {0,1,0.69531,1},
        {0,1,0.71875,1},
        {0,1,0.74219,1},
        {0,1,0.76562,1},
        {0,1,0.78906,1},
        {0,1,0.8125,1},
        {0,1,0.83594,1},
        {0,1,0.85938,1},
        {0,1,0.88281,1},
        {0,1,0.90625,1},
        {0,1,0.92969,1},
        {0,1,0.95312,1},
        {0,1,0.97656,1},
        {0,1,1,1},
        {0,0.97656,1,1},
        {0,0.95312,1,1},
        {0,0.92969,1,1},
        {0,0.90625,1,1},
        {0,0.88281,1,1},
        {0,0.85938,1,1},
        {0,0.83594,1,1},
        {0,0.8125,1,1},
        {0,0.78906,1,1},
        {0,0.76562,1,1},
        {0,0.74219,1,1},
        {0,0.71875,1,1},
        {0,0.69531,1,1},
        {0,0.67188,1,1},
        {0,0.64844,1,1},
        {0,0.625,1,1},
        {0,0.60156,1,1},
        {0,0.57812,1,1},
        {0,0.55469,1,1},
        {0,0.53125,1,1},
        {0,0.50781,1,1},
        {0,0.48438,1,1},
        {0,0.46094,1,1},
        {0,0.4375,1,1},
        {0,0.41406,1,1},
        {0,0.39062,1,1},
        {0,0.36719,1,1},
        {0,0.34375,1,1},
        {0,0.32031,1,1},
        {0,0.29688,1,1},
        {0,0.27344,1,1},
        {0,0.25,1,1},
        {0,0.22656,1,1},
        {0,0.20312,1,1},
        {0,0.17969,1,1},
        {0,0.15625,1,1},
        {0,0.13281,1,1},
        {0,0.10938,1,1},
        {0,0.085938,1,1},
        {0,0.0625,1,1},
        {0,0.039062,1,1},
        {0,0.015625,1,1},
        {0.0078125,0,1,1},
        {0.03125,0,1,1},
        {0.054688,0,1,1},
        {0.078125,0,1,1},
        {0.10156,0,1,1},
        {0.125,0,1,1},
        {0.14844,0,1,1},
        {0.17188,0,1,1},
        {0.19531,0,1,1},
        {0.21875,0,1,1},
        {0.24219,0,1,1},
        {0.26562,0,1,1},
        {0.28906,0,1,1},
        {0.3125,0,1,1},
        {0.33594,0,1,1},
        {0.35938,0,1,1},
        {0.38281,0,1,1},
        {0.40625,0,1,1},
        {0.42969,0,1,1},
        {0.45312,0,1,1},
        {0.47656,0,1,1},
        {0.5,0,1,1},
        {0.52344,0,1,1},
        {0.54688,0,1,1},
        {0.57031,0,1,1},
        {0.59375,0,1,1},
        {0.61719,0,1,1},
        {0.64062,0,1,1},
        {0.66406,0,1,1},
        {0.6875,0,1,1},
        {0.71094,0,1,1},
        {0.73438,0,1,1},
        {0.75781,0,1,1},
        {0.78125,0,1,1},
        {0.80469,0,1,1},
        {0.82812,0,1,1},
        {0.85156,0,1,1},
        {0.875,0,1,1},
        {0.89844,0,1,1},
        {0.92188,0,1,1},
        {0.94531,0,1,1},
        {0.96875,0,1,1},
        {0.99219,0,1,1},
        {1,0,0.98438,1},
        {1,0,0.96094,1},
        {1,0,0.9375,1},
        {1,0,0.91406,1},
        {1,0,0.89062,1},
        {1,0,0.86719,1},
        {1,0,0.84375,1},
        {1,0,0.82031,1},
        {1,0,0.79688,1},
        {1,0,0.77344,1},
        {1,0,0.75,1},
        {1,0,0.72656,1},
        {1,0,0.70312,1},
        {1,0,0.67969,1},
        {1,0,0.65625,1},
        {1,0,0.63281,1},
        {1,0,0.60938,1},
        {1,0,0.58594,1},
        {1,0,0.5625,1},
        {1,0,0.53906,1},
        {1,0,0.51562,1},
        {1,0,0.49219,1},
        {1,0,0.46875,1},
        {1,0,0.44531,1},
        {1,0,0.42188,1},
        {1,0,0.39844,1},
        {1,0,0.375,1},
        {1,0,0.35156,1},
        {1,0,0.32812,1},
        {1,0,0.30469,1},
        {1,0,0.28125,1},
        {1,0,0.25781,1},
        {1,0,0.23438,1},
        {1,0,0.21094,1},
        {1,0,0.1875,1},
        {1,0,0.16406,1},
        {1,0,0.14062,1},
        {1,0,0.11719,1},
        {1,0,0.09375,1},
        {1,0,0.070312,1},
        {1,0,0.046875,1},
        {1,0,0.023438,1}
    };
    static float jet[256][4] =
    {
        {0,0,0.51562,1},
        {0,0,0.53125,1},
        {0,0,0.54688,1},
        {0,0,0.5625,1},
        {0,0,0.57812,1},
        {0,0,0.59375,1},
        {0,0,0.60938,1},
        {0,0,0.625,1},
        {0,0,0.64062,1},
        {0,0,0.65625,1},
        {0,0,0.67188,1},
        {0,0,0.6875,1},
        {0,0,0.70312,1},
        {0,0,0.71875,1},
        {0,0,0.73438,1},
        {0,0,0.75,1},
        {0,0,0.76562,1},
        {0,0,0.78125,1},
        {0,0,0.79688,1},
        {0,0,0.8125,1},
        {0,0,0.82812,1},
        {0,0,0.84375,1},
        {0,0,0.85938,1},
        {0,0,0.875,1},
        {0,0,0.89062,1},
        {0,0,0.90625,1},
        {0,0,0.92188,1},
        {0,0,0.9375,1},
        {0,0,0.95312,1},
        {0,0,0.96875,1},
        {0,0,0.98438,1},
        {0,0,1,1},
        {0,0.015625,1,1},
        {0,0.03125,1,1},
        {0,0.046875,1,1},
        {0,0.0625,1,1},
        {0,0.078125,1,1},
        {0,0.09375,1,1},
        {0,0.10938,1,1},
        {0,0.125,1,1},
        {0,0.14062,1,1},
        {0,0.15625,1,1},
        {0,0.17188,1,1},
        {0,0.1875,1,1},
        {0,0.20312,1,1},
        {0,0.21875,1,1},
        {0,0.23438,1,1},
        {0,0.25,1,1},
        {0,0.26562,1,1},
        {0,0.28125,1,1},
        {0,0.29688,1,1},
        {0,0.3125,1,1},
        {0,0.32812,1,1},
        {0,0.34375,1,1},
        {0,0.35938,1,1},
        {0,0.375,1,1},
        {0,0.39062,1,1},
        {0,0.40625,1,1},
        {0,0.42188,1,1},
        {0,0.4375,1,1},
        {0,0.45312,1,1},
        {0,0.46875,1,1},
        {0,0.48438,1,1},
        {0,0.5,1,1},
        {0,0.51562,1,1},
        {0,0.53125,1,1},
        {0,0.54688,1,1},
        {0,0.5625,1,1},
        {0,0.57812,1,1},
        {0,0.59375,1,1},
        {0,0.60938,1,1},
        {0,0.625,1,1},
        {0,0.64062,1,1},
        {0,0.65625,1,1},
        {0,0.67188,1,1},
        {0,0.6875,1,1},
        {0,0.70312,1,1},
        {0,0.71875,1,1},
        {0,0.73438,1,1},
        {0,0.75,1,1},
        {0,0.76562,1,1},
        {0,0.78125,1,1},
        {0,0.79688,1,1},
        {0,0.8125,1,1},
        {0,0.82812,1,1},
        {0,0.84375,1,1},
        {0,0.85938,1,1},
        {0,0.875,1,1},
        {0,0.89062,1,1},
        {0,0.90625,1,1},
        {0,0.92188,1,1},
        {0,0.9375,1,1},
        {0,0.95312,1,1},
        {0,0.96875,1,1},
        {0,0.98438,1,1},
        {0,1,1,1},
        {0.015625,1,0.98438,1},
        {0.03125,1,0.96875,1},
        {0.046875,1,0.95312,1},
        {0.0625,1,0.9375,1},
        {0.078125,1,0.92188,1},
        {0.09375,1,0.90625,1},
        {0.10938,1,0.89062,1},
        {0.125,1,0.875,1},
        {0.14062,1,0.85938,1},
        {0.15625,1,0.84375,1},
        {0.17188,1,0.82812,1},
        {0.1875,1,0.8125,1},
        {0.20312,1,0.79688,1},
        {0.21875,1,0.78125,1},
        {0.23438,1,0.76562,1},
        {0.25,1,0.75,1},
        {0.26562,1,0.73438,1},
        {0.28125,1,0.71875,1},
        {0.29688,1,0.70312,1},
        {0.3125,1,0.6875,1},
        {0.32812,1,0.67188,1},
        {0.34375,1,0.65625,1},
        {0.35938,1,0.64062,1},
        {0.375,1,0.625,1},
        {0.39062,1,0.60938,1},
        {0.40625,1,0.59375,1},
        {0.42188,1,0.57812,1},
        {0.4375,1,0.5625,1},
        {0.45312,1,0.54688,1},
        {0.46875,1,0.53125,1},
        {0.48438,1,0.51562,1},
        {0.5,1,0.5,1},
        {0.51562,1,0.48438,1},
        {0.53125,1,0.46875,1},
        {0.54688,1,0.45312,1},
        {0.5625,1,0.4375,1},
        {0.57812,1,0.42188,1},
        {0.59375,1,0.40625,1},
        {0.60938,1,0.39062,1},
        {0.625,1,0.375,1},
        {0.64062,1,0.35938,1},
        {0.65625,1,0.34375,1},
        {0.67188,1,0.32812,1},
        {0.6875,1,0.3125,1},
        {0.70312,1,0.29688,1},
        {0.71875,1,0.28125,1},
        {0.73438,1,0.26562,1},
        {0.75,1,0.25,1},
        {0.76562,1,0.23438,1},
        {0.78125,1,0.21875,1},
        {0.79688,1,0.20312,1},
        {0.8125,1,0.1875,1},
        {0.82812,1,0.17188,1},
        {0.84375,1,0.15625,1},
        {0.85938,1,0.14062,1},
        {0.875,1,0.125,1},
        {0.89062,1,0.10938,1},
        {0.90625,1,0.09375,1},
        {0.92188,1,0.078125,1},
        {0.9375,1,0.0625,1},
        {0.95312,1,0.046875,1},
        {0.96875,1,0.03125,1},
        {0.98438,1,0.015625,1},
        {1,1,0,1},
        {1,0.98438,0,1},
        {1,0.96875,0,1},
        {1,0.95312,0,1},
        {1,0.9375,0,1},
        {1,0.92188,0,1},
        {1,0.90625,0,1},
        {1,0.89062,0,1},
        {1,0.875,0,1},
        {1,0.85938,0,1},
        {1,0.84375,0,1},
        {1,0.82812,0,1},
        {1,0.8125,0,1},
        {1,0.79688,0,1},
        {1,0.78125,0,1},
        {1,0.76562,0,1},
        {1,0.75,0,1},
        {1,0.73438,0,1},
        {1,0.71875,0,1},
        {1,0.70312,0,1},
        {1,0.6875,0,1},
        {1,0.67188,0,1},
        {1,0.65625,0,1},
        {1,0.64062,0,1},
        {1,0.625,0,1},
        {1,0.60938,0,1},
        {1,0.59375,0,1},
        {1,0.57812,0,1},
        {1,0.5625,0,1},
        {1,0.54688,0,1},
        {1,0.53125,0,1},
        {1,0.51562,0,1},
        {1,0.5,0,1},
        {1,0.48438,0,1},
        {1,0.46875,0,1},
        {1,0.45312,0,1},
        {1,0.4375,0,1},
        {1,0.42188,0,1},
        {1,0.40625,0,1},
        {1,0.39062,0,1},
        {1,0.375,0,1},
        {1,0.35938,0,1},
        {1,0.34375,0,1},
        {1,0.32812,0,1},
        {1,0.3125,0,1},
        {1,0.29688,0,1},
        {1,0.28125,0,1},
        {1,0.26562,0,1},
        {1,0.25,0,1},
        {1,0.23438,0,1},
        {1,0.21875,0,1},
        {1,0.20312,0,1},
        {1,0.1875,0,1},
        {1,0.17188,0,1},
        {1,0.15625,0,1},
        {1,0.14062,0,1},
        {1,0.125,0,1},
        {1,0.10938,0,1},
        {1,0.09375,0,1},
        {1,0.078125,0,1},
        {1,0.0625,0,1},
        {1,0.046875,0,1},
        {1,0.03125,0,1},
        {1,0.015625,0,1},
        {1,0,0,1},
        {0.98438,0,0,1},
        {0.96875,0,0,1},
        {0.95312,0,0,1},
        {0.9375,0,0,1},
        {0.92188,0,0,1},
        {0.90625,0,0,1},
        {0.89062,0,0,1},
        {0.875,0,0,1},
        {0.85938,0,0,1},
        {0.84375,0,0,1},
        {0.82812,0,0,1},
        {0.8125,0,0,1},
        {0.79688,0,0,1},
        {0.78125,0,0,1},
        {0.76562,0,0,1},
        {0.75,0,0,1},
        {0.73438,0,0,1},
        {0.71875,0,0,1},
        {0.70312,0,0,1},
        {0.6875,0,0,1},
        {0.67188,0,0,1},
        {0.65625,0,0,1},
        {0.64062,0,0,1},
        {0.625,0,0,1},
        {0.60938,0,0,1},
        {0.59375,0,0,1},
        {0.57812,0,0,1},
        {0.5625,0,0,1},
        {0.54688,0,0,1},
        {0.53125,0,0,1},
        {0.51562,0,0,1},
        {0.5,0,0,1}
    };
    static float parula[256][4] =
    {
        {0.2081,0.1663,0.5292,1},
        {0.2091,0.1721,0.5411,1},
        {0.2101,0.1779,0.553,1},
        {0.2109,0.1837,0.565,1},
        {0.2116,0.1895,0.5771,1},
        {0.2121,0.1954,0.5892,1},
        {0.2124,0.2013,0.6013,1},
        {0.2125,0.2072,0.6135,1},
        {0.2123,0.2132,0.6258,1},
        {0.2118,0.2192,0.6381,1},
        {0.2111,0.2253,0.6505,1},
        {0.2099,0.2315,0.6629,1},
        {0.2084,0.2377,0.6753,1},
        {0.2063,0.244,0.6878,1},
        {0.2038,0.2503,0.7003,1},
        {0.2006,0.2568,0.7129,1},
        {0.1968,0.2632,0.7255,1},
        {0.1921,0.2698,0.7381,1},
        {0.1867,0.2764,0.7507,1},
        {0.1802,0.2832,0.7634,1},
        {0.1728,0.2902,0.7762,1},
        {0.1641,0.2975,0.789,1},
        {0.1541,0.3052,0.8017,1},
        {0.1427,0.3132,0.8145,1},
        {0.1295,0.3217,0.8269,1},
        {0.1147,0.3306,0.8387,1},
        {0.0986,0.3397,0.8495,1},
        {0.0816,0.3486,0.8588,1},
        {0.0646,0.3572,0.8664,1},
        {0.0482,0.3651,0.8722,1},
        {0.0329,0.3724,0.8765,1},
        {0.0213,0.3792,0.8796,1},
        {0.0136,0.3853,0.8815,1},
        {0.0086,0.3911,0.8827,1},
        {0.006,0.3965,0.8833,1},
        {0.0051,0.4017,0.8834,1},
        {0.0054,0.4066,0.8831,1},
        {0.0067,0.4113,0.8825,1},
        {0.0089,0.4159,0.8816,1},
        {0.0116,0.4203,0.8805,1},
        {0.0148,0.4246,0.8793,1},
        {0.0184,0.4288,0.8779,1},
        {0.0223,0.4329,0.8763,1},
        {0.0264,0.437,0.8747,1},
        {0.0306,0.441,0.8729,1},
        {0.0349,0.4449,0.8711,1},
        {0.0394,0.4488,0.8692,1},
        {0.0437,0.4526,0.8672,1},
        {0.0477,0.4564,0.8652,1},
        {0.0514,0.4602,0.8632,1},
        {0.0549,0.464,0.8611,1},
        {0.0582,0.4677,0.8589,1},
        {0.0612,0.4714,0.8568,1},
        {0.064,0.4751,0.8546,1},
        {0.0666,0.4788,0.8525,1},
        {0.0689,0.4825,0.8503,1},
        {0.071,0.4862,0.8481,1},
        {0.0729,0.4899,0.846,1},
        {0.0746,0.4937,0.8439,1},
        {0.0761,0.4974,0.8418,1},
        {0.0773,0.5012,0.8398,1},
        {0.0782,0.5051,0.8378,1},
        {0.0789,0.5089,0.8359,1},
        {0.0794,0.5129,0.8341,1},
        {0.0795,0.5169,0.8324,1},
        {0.0793,0.521,0.8308,1},
        {0.0788,0.5251,0.8293,1},
        {0.0778,0.5295,0.828,1},
        {0.0764,0.5339,0.827,1},
        {0.0746,0.5384,0.8261,1},
        {0.0724,0.5431,0.8253,1},
        {0.0698,0.5479,0.8247,1},
        {0.0668,0.5527,0.8243,1},
        {0.0636,0.5577,0.8239,1},
        {0.06,0.5627,0.8237,1},
        {0.0562,0.5677,0.8234,1},
        {0.0523,0.5727,0.8231,1},
        {0.0484,0.5777,0.8228,1},
        {0.0445,0.5826,0.8223,1},
        {0.0408,0.5874,0.8217,1},
        {0.0372,0.5922,0.8209,1},
        {0.0342,0.5968,0.8198,1},
        {0.0317,0.6012,0.8186,1},
        {0.0296,0.6055,0.8171,1},
        {0.0279,0.6097,0.8154,1},
        {0.0265,0.6137,0.8135,1},
        {0.0255,0.6176,0.8114,1},
        {0.0248,0.6214,0.8091,1},
        {0.0243,0.625,0.8066,1},
        {0.0239,0.6285,0.8039,1},
        {0.0237,0.6319,0.801,1},
        {0.0235,0.6352,0.798,1},
        {0.0233,0.6384,0.7948,1},
        {0.0231,0.6415,0.7916,1},
        {0.023,0.6445,0.7881,1},
        {0.0229,0.6474,0.7846,1},
        {0.0227,0.6503,0.781,1},
        {0.0227,0.6531,0.7773,1},
        {0.0232,0.6558,0.7735,1},
        {0.0238,0.6585,0.7696,1},
        {0.0246,0.6611,0.7656,1},
        {0.0263,0.6637,0.7615,1},
        {0.0282,0.6663,0.7574,1},
        {0.0306,0.6688,0.7532,1},
        {0.0338,0.6712,0.749,1},
        {0.0373,0.6737,0.7446,1},
        {0.0418,0.6761,0.7402,1},
        {0.0467,0.6784,0.7358,1},
        {0.0516,0.6808,0.7313,1},
        {0.0574,0.6831,0.7267,1},
        {0.0629,0.6854,0.7221,1},
        {0.0692,0.6877,0.7173,1},
        {0.0755,0.6899,0.7126,1},
        {0.082,0.6921,0.7078,1},
        {0.0889,0.6943,0.7029,1},
        {0.0956,0.6965,0.6979,1},
        {0.1031,0.6986,0.6929,1},
        {0.1104,0.7007,0.6878,1},
        {0.118,0.7028,0.6827,1},
        {0.1258,0.7049,0.6775,1},
        {0.1335,0.7069,0.6723,1},
        {0.1418,0.7089,0.6669,1},
        {0.1499,0.7109,0.6616,1},
        {0.1585,0.7129,0.6561,1},
        {0.1671,0.7148,0.6507,1},
        {0.1758,0.7168,0.6451,1},
        {0.1849,0.7186,0.6395,1},
        {0.1938,0.7205,0.6338,1},
        {0.2033,0.7223,0.6281,1},
        {0.2128,0.7241,0.6223,1},
        {0.2224,0.7259,0.6165,1},
        {0.2324,0.7275,0.6107,1},
        {0.2423,0.7292,0.6048,1},
        {0.2527,0.7308,0.5988,1},
        {0.2631,0.7324,0.5929,1},
        {0.2735,0.7339,0.5869,1},
        {0.2845,0.7354,0.5809,1},
        {0.2953,0.7368,0.5749,1},
        {0.3064,0.7381,0.5689,1},
        {0.3177,0.7394,0.563,1},
        {0.3289,0.7406,0.557,1},
        {0.3405,0.7417,0.5512,1},
        {0.352,0.7428,0.5453,1},
        {0.3635,0.7438,0.5396,1},
        {0.3753,0.7446,0.5339,1},
        {0.3869,0.7454,0.5283,1},
        {0.3986,0.7461,0.5229,1},
        {0.4103,0.7467,0.5175,1},
        {0.4218,0.7473,0.5123,1},
        {0.4334,0.7477,0.5072,1},
        {0.4447,0.7482,0.5021,1},
        {0.4561,0.7485,0.4972,1},
        {0.4672,0.7487,0.4924,1},
        {0.4783,0.7489,0.4877,1},
        {0.4892,0.7491,0.4831,1},
        {0.5,0.7491,0.4786,1},
        {0.5106,0.7492,0.4741,1},
        {0.5212,0.7492,0.4698,1},
        {0.5315,0.7491,0.4655,1},
        {0.5418,0.749,0.4613,1},
        {0.5519,0.7489,0.4571,1},
        {0.5619,0.7487,0.4531,1},
        {0.5718,0.7485,0.449,1},
        {0.5816,0.7482,0.4451,1},
        {0.5913,0.7479,0.4412,1},
        {0.6009,0.7476,0.4374,1},
        {0.6103,0.7473,0.4335,1},
        {0.6197,0.7469,0.4298,1},
        {0.629,0.7465,0.4261,1},
        {0.6382,0.746,0.4224,1},
        {0.6473,0.7456,0.4188,1},
        {0.6564,0.7451,0.4152,1},
        {0.6653,0.7446,0.4116,1},
        {0.6742,0.7441,0.4081,1},
        {0.683,0.7435,0.4046,1},
        {0.6918,0.743,0.4011,1},
        {0.7004,0.7424,0.3976,1},
        {0.7091,0.7418,0.3942,1},
        {0.7176,0.7412,0.3908,1},
        {0.7261,0.7405,0.3874,1},
        {0.7346,0.7399,0.384,1},
        {0.743,0.7392,0.3806,1},
        {0.7513,0.7385,0.3773,1},
        {0.7596,0.7378,0.3739,1},
        {0.7679,0.7372,0.3706,1},
        {0.7761,0.7364,0.3673,1},
        {0.7843,0.7357,0.3639,1},
        {0.7924,0.735,0.3606,1},
        {0.8005,0.7343,0.3573,1},
        {0.8085,0.7336,0.3539,1},
        {0.8166,0.7329,0.3506,1},
        {0.8246,0.7322,0.3472,1},
        {0.8325,0.7315,0.3438,1},
        {0.8405,0.7308,0.3404,1},
        {0.8484,0.7301,0.337,1},
        {0.8563,0.7294,0.3336,1},
        {0.8642,0.7288,0.33,1},
        {0.872,0.7282,0.3265,1},
        {0.8798,0.7276,0.3229,1},
        {0.8877,0.7271,0.3193,1},
        {0.8954,0.7266,0.3156,1},
        {0.9032,0.7262,0.3117,1},
        {0.911,0.7259,0.3078,1},
        {0.9187,0.7256,0.3038,1},
        {0.9264,0.7256,0.2996,1},
        {0.9341,0.7256,0.2953,1},
        {0.9417,0.7259,0.2907,1},
        {0.9493,0.7264,0.2859,1},
        {0.9567,0.7273,0.2808,1},
        {0.9639,0.7285,0.2754,1},
        {0.9708,0.7303,0.2696,1},
        {0.9773,0.7326,0.2634,1},
        {0.9831,0.7355,0.257,1},
        {0.9882,0.739,0.2504,1},
        {0.9922,0.7431,0.2437,1},
        {0.9952,0.7476,0.2373,1},
        {0.9973,0.7524,0.231,1},
        {0.9986,0.7573,0.2251,1},
        {0.9991,0.7624,0.2195,1},
        {0.999,0.7675,0.2141,1},
        {0.9985,0.7726,0.209,1},
        {0.9976,0.7778,0.2042,1},
        {0.9964,0.7829,0.1995,1},
        {0.995,0.788,0.1949,1},
        {0.9933,0.7931,0.1905,1},
        {0.9914,0.7981,0.1863,1},
        {0.9894,0.8032,0.1821,1},
        {0.9873,0.8083,0.178,1},
        {0.9851,0.8133,0.174,1},
        {0.9828,0.8184,0.17,1},
        {0.9805,0.8235,0.1661,1},
        {0.9782,0.8286,0.1622,1},
        {0.9759,0.8337,0.1583,1},
        {0.9736,0.8389,0.1544,1},
        {0.9713,0.8441,0.1505,1},
        {0.9692,0.8494,0.1465,1},
        {0.9672,0.8548,0.1425,1},
        {0.9654,0.8603,0.1385,1},
        {0.9638,0.8659,0.1343,1},
        {0.9623,0.8716,0.1301,1},
        {0.9611,0.8774,0.1258,1},
        {0.96,0.8834,0.1215,1},
        {0.9593,0.8895,0.1171,1},
        {0.9588,0.8958,0.1126,1},
        {0.9586,0.9022,0.1082,1},
        {0.9587,0.9088,0.1036,1},
        {0.9591,0.9155,0.099,1},
        {0.9599,0.9225,0.0944,1},
        {0.961,0.9296,0.0897,1},
        {0.9624,0.9368,0.085,1},
        {0.9641,0.9443,0.0802,1},
        {0.9662,0.9518,0.0753,1},
        {0.9685,0.9595,0.0703,1},
        {0.971,0.9673,0.0651,1},
        {0.9736,0.9752,0.0597,1},
        {0.9763,0.9831,0.0538,1}
    };

    float (*mapPtr)[256][4];
    switch (m)
    {
    case GreyColourMap:
        mapPtr = &grey;
        break;
    case CoolColourMap:
        mapPtr = &cool;
        break;
    case HotColourMap:
        mapPtr = &hot;
        break;
    case HSVColourMap:
        mapPtr = &hsv;
        break;
    case JetColourMap:
        mapPtr = &jet;
        break;
    case ParulaColourMap:
        mapPtr = &parula;
        break;
    }

    int i = (int)(index * 256);
    if (i < 0) i = 0;
    else if (i >= 256) i = 255;
    if (invert) i = 255 - i;
    mappedColour->SetColour((*mapPtr)[i][0], (*mapPtr)[i][1], (*mapPtr)[i][2], (*mapPtr)[i][3]);

    // printf("index = %f, %d\n", index, i);
    // printf("%f %f %f %f\n", mappedColour->r, mappedColour->g, mappedColour->b, mappedColour->alpha);
}

#ifdef LOCAL_GLU
// these functions are from project.c in the mesa version of glu which seem to be missing in VS2013

// get rid of defines we don't want
#define GLAPIENTRY
#define COS cos

/*
** Make m an identity matrix
*/
static void __gluMakeIdentityd(double m[16])
{
    m[0+4*0] = 1; m[0+4*1] = 0; m[0+4*2] = 0; m[0+4*3] = 0;
    m[1+4*0] = 0; m[1+4*1] = 1; m[1+4*2] = 0; m[1+4*3] = 0;
    m[2+4*0] = 0; m[2+4*1] = 0; m[2+4*2] = 1; m[2+4*3] = 0;
    m[3+4*0] = 0; m[3+4*1] = 0; m[3+4*2] = 0; m[3+4*3] = 1;
}

static void __gluMakeIdentityf(float m[16])
{
    m[0+4*0] = 1; m[0+4*1] = 0; m[0+4*2] = 0; m[0+4*3] = 0;
    m[1+4*0] = 0; m[1+4*1] = 1; m[1+4*2] = 0; m[1+4*3] = 0;
    m[2+4*0] = 0; m[2+4*1] = 0; m[2+4*2] = 1; m[2+4*3] = 0;
    m[3+4*0] = 0; m[3+4*1] = 0; m[3+4*2] = 0; m[3+4*3] = 1;
}

void GLAPIENTRY
gluOrtho2D(double left, double right, double bottom, double top)
{
    glOrtho(left, right, bottom, top, -1, 1);
}

#define __glPi 3.14159265358979323846

void GLAPIENTRY
gluPerspective(double fovy, double aspect, double zNear, double zFar)
{
    double m[4][4];
    double sine, cotangent, deltaZ;
    double radians = fovy / 2 * __glPi / 180;

    deltaZ = zFar - zNear;
    sine = sin(radians);
    if ((deltaZ == 0) || (sine == 0) || (aspect == 0)) {
    return;
    }
    cotangent = COS(radians) / sine;

    __gluMakeIdentityd(&m[0][0]);
    m[0][0] = cotangent / aspect;
    m[1][1] = cotangent;
    m[2][2] = -(zFar + zNear) / deltaZ;
    m[2][3] = -1;
    m[3][2] = -2 * zNear * zFar / deltaZ;
    m[3][3] = 0;
    glMultMatrixd(&m[0][0]);
}

static void normalize(float v[3])
{
    float r;

    r = sqrt( v[0]*v[0] + v[1]*v[1] + v[2]*v[2] );
    if (r == 0.0) return;

    v[0] /= r;
    v[1] /= r;
    v[2] /= r;
}

static void cross(float v1[3], float v2[3], float result[3])
{
    result[0] = v1[1]*v2[2] - v1[2]*v2[1];
    result[1] = v1[2]*v2[0] - v1[0]*v2[2];
    result[2] = v1[0]*v2[1] - v1[1]*v2[0];
}

void GLAPIENTRY
gluLookAt(double eyex, double eyey, double eyez, double centerx,
      double centery, double centerz, double upx, double upy,
      double upz)
{
    float forward[3], side[3], up[3];
    float m[4][4];

    forward[0] = centerx - eyex;
    forward[1] = centery - eyey;
    forward[2] = centerz - eyez;

    up[0] = upx;
    up[1] = upy;
    up[2] = upz;

    normalize(forward);

    /* Side = forward x up */
    cross(forward, up, side);
    normalize(side);

    /* Recompute up as: up = side x forward */
    cross(side, forward, up);

    __gluMakeIdentityf(&m[0][0]);
    m[0][0] = side[0];
    m[1][0] = side[1];
    m[2][0] = side[2];

    m[0][1] = up[0];
    m[1][1] = up[1];
    m[2][1] = up[2];

    m[0][2] = -forward[0];
    m[1][2] = -forward[1];
    m[2][2] = -forward[2];

    glMultMatrixf(&m[0][0]);
    glTranslated(-eyex, -eyey, -eyez);
}

static void __gluMultMatrixVecd(const double matrix[16], const double in[4],
              double out[4])
{
    int i;

    for (i=0; i<4; i++) {
    out[i] =
        in[0] * matrix[0*4+i] +
        in[1] * matrix[1*4+i] +
        in[2] * matrix[2*4+i] +
        in[3] * matrix[3*4+i];
    }
}

/*
** Invert 4x4 matrix.
** Contributed by David Moore (See Mesa bug #6748)
*/
static int __gluInvertMatrixd(const double m[16], double invOut[16])
{
    double inv[16], det;
    int i;

    inv[0] =   m[5]*m[10]*m[15] - m[5]*m[11]*m[14] - m[9]*m[6]*m[15]
             + m[9]*m[7]*m[14] + m[13]*m[6]*m[11] - m[13]*m[7]*m[10];
    inv[4] =  -m[4]*m[10]*m[15] + m[4]*m[11]*m[14] + m[8]*m[6]*m[15]
             - m[8]*m[7]*m[14] - m[12]*m[6]*m[11] + m[12]*m[7]*m[10];
    inv[8] =   m[4]*m[9]*m[15] - m[4]*m[11]*m[13] - m[8]*m[5]*m[15]
             + m[8]*m[7]*m[13] + m[12]*m[5]*m[11] - m[12]*m[7]*m[9];
    inv[12] = -m[4]*m[9]*m[14] + m[4]*m[10]*m[13] + m[8]*m[5]*m[14]
             - m[8]*m[6]*m[13] - m[12]*m[5]*m[10] + m[12]*m[6]*m[9];
    inv[1] =  -m[1]*m[10]*m[15] + m[1]*m[11]*m[14] + m[9]*m[2]*m[15]
             - m[9]*m[3]*m[14] - m[13]*m[2]*m[11] + m[13]*m[3]*m[10];
    inv[5] =   m[0]*m[10]*m[15] - m[0]*m[11]*m[14] - m[8]*m[2]*m[15]
             + m[8]*m[3]*m[14] + m[12]*m[2]*m[11] - m[12]*m[3]*m[10];
    inv[9] =  -m[0]*m[9]*m[15] + m[0]*m[11]*m[13] + m[8]*m[1]*m[15]
             - m[8]*m[3]*m[13] - m[12]*m[1]*m[11] + m[12]*m[3]*m[9];
    inv[13] =  m[0]*m[9]*m[14] - m[0]*m[10]*m[13] - m[8]*m[1]*m[14]
             + m[8]*m[2]*m[13] + m[12]*m[1]*m[10] - m[12]*m[2]*m[9];
    inv[2] =   m[1]*m[6]*m[15] - m[1]*m[7]*m[14] - m[5]*m[2]*m[15]
             + m[5]*m[3]*m[14] + m[13]*m[2]*m[7] - m[13]*m[3]*m[6];
    inv[6] =  -m[0]*m[6]*m[15] + m[0]*m[7]*m[14] + m[4]*m[2]*m[15]
             - m[4]*m[3]*m[14] - m[12]*m[2]*m[7] + m[12]*m[3]*m[6];
    inv[10] =  m[0]*m[5]*m[15] - m[0]*m[7]*m[13] - m[4]*m[1]*m[15]
             + m[4]*m[3]*m[13] + m[12]*m[1]*m[7] - m[12]*m[3]*m[5];
    inv[14] = -m[0]*m[5]*m[14] + m[0]*m[6]*m[13] + m[4]*m[1]*m[14]
             - m[4]*m[2]*m[13] - m[12]*m[1]*m[6] + m[12]*m[2]*m[5];
    inv[3] =  -m[1]*m[6]*m[11] + m[1]*m[7]*m[10] + m[5]*m[2]*m[11]
             - m[5]*m[3]*m[10] - m[9]*m[2]*m[7] + m[9]*m[3]*m[6];
    inv[7] =   m[0]*m[6]*m[11] - m[0]*m[7]*m[10] - m[4]*m[2]*m[11]
             + m[4]*m[3]*m[10] + m[8]*m[2]*m[7] - m[8]*m[3]*m[6];
    inv[11] = -m[0]*m[5]*m[11] + m[0]*m[7]*m[9] + m[4]*m[1]*m[11]
             - m[4]*m[3]*m[9] - m[8]*m[1]*m[7] + m[8]*m[3]*m[5];
    inv[15] =  m[0]*m[5]*m[10] - m[0]*m[6]*m[9] - m[4]*m[1]*m[10]
             + m[4]*m[2]*m[9] + m[8]*m[1]*m[6] - m[8]*m[2]*m[5];

    det = m[0]*inv[0] + m[1]*inv[4] + m[2]*inv[8] + m[3]*inv[12];
    if (det == 0)
        return GL_FALSE;

    det = 1.0 / det;

    for (i = 0; i < 16; i++)
        invOut[i] = inv[i] * det;

    return GL_TRUE;
}

static void __gluMultMatricesd(const double a[16], const double b[16],
                double r[16])
{
    int i, j;

    for (i = 0; i < 4; i++) {
    for (j = 0; j < 4; j++) {
        r[i*4+j] =
        a[i*4+0]*b[0*4+j] +
        a[i*4+1]*b[1*4+j] +
        a[i*4+2]*b[2*4+j] +
        a[i*4+3]*b[3*4+j];
    }
    }
}

int GLAPIENTRY
gluProject(double objx, double objy, double objz,
          const double modelMatrix[16],
          const double projMatrix[16],
              const int viewport[4],
          double *winx, double *winy, double *winz)
{
    double in[4];
    double out[4];

    in[0]=objx;
    in[1]=objy;
    in[2]=objz;
    in[3]=1.0;
    __gluMultMatrixVecd(modelMatrix, in, out);
    __gluMultMatrixVecd(projMatrix, out, in);
    if (in[3] == 0.0) return(GL_FALSE);
    in[0] /= in[3];
    in[1] /= in[3];
    in[2] /= in[3];
    /* Map x, y and z to range 0-1 */
    in[0] = in[0] * 0.5 + 0.5;
    in[1] = in[1] * 0.5 + 0.5;
    in[2] = in[2] * 0.5 + 0.5;

    /* Map x,y to viewport */
    in[0] = in[0] * viewport[2] + viewport[0];
    in[1] = in[1] * viewport[3] + viewport[1];

    *winx=in[0];
    *winy=in[1];
    *winz=in[2];
    return(GL_TRUE);
}

int GLAPIENTRY
gluUnProject(double winx, double winy, double winz,
        const double modelMatrix[16],
        const double projMatrix[16],
                const int viewport[4],
            double *objx, double *objy, double *objz)
{
    double finalMatrix[16];
    double in[4];
    double out[4];

    __gluMultMatricesd(modelMatrix, projMatrix, finalMatrix);
    if (!__gluInvertMatrixd(finalMatrix, finalMatrix)) return(GL_FALSE);

    in[0]=winx;
    in[1]=winy;
    in[2]=winz;
    in[3]=1.0;

    /* Map x and y from window coordinates */
    in[0] = (in[0] - viewport[0]) / viewport[2];
    in[1] = (in[1] - viewport[1]) / viewport[3];

    /* Map to range -1 to 1 */
    in[0] = in[0] * 2 - 1;
    in[1] = in[1] * 2 - 1;
    in[2] = in[2] * 2 - 1;

    __gluMultMatrixVecd(finalMatrix, in, out);
    if (out[3] == 0.0) return(GL_FALSE);
    out[0] /= out[3];
    out[1] /= out[3];
    out[2] /= out[3];
    *objx = out[0];
    *objy = out[1];
    *objz = out[2];
    return(GL_TRUE);
}

int GLAPIENTRY
gluUnProject4(double winx, double winy, double winz, double clipw,
          const double modelMatrix[16],
          const double projMatrix[16],
          const int viewport[4],
          double nearVal, double farVal,
          double *objx, double *objy, double *objz,
          double *objw)
{
    double finalMatrix[16];
    double in[4];
    double out[4];

    __gluMultMatricesd(modelMatrix, projMatrix, finalMatrix);
    if (!__gluInvertMatrixd(finalMatrix, finalMatrix)) return(GL_FALSE);

    in[0]=winx;
    in[1]=winy;
    in[2]=winz;
    in[3]=clipw;

    /* Map x and y from window coordinates */
    in[0] = (in[0] - viewport[0]) / viewport[2];
    in[1] = (in[1] - viewport[1]) / viewport[3];
    in[2] = (in[2] - nearVal) / (farVal - nearVal);

    /* Map to range -1 to 1 */
    in[0] = in[0] * 2 - 1;
    in[1] = in[1] * 2 - 1;
    in[2] = in[2] * 2 - 1;

    __gluMultMatrixVecd(finalMatrix, in, out);
    if (out[3] == 0.0) return(GL_FALSE);
    *objx = out[0];
    *objy = out[1];
    *objz = out[2];
    *objw = out[3];
    return(GL_TRUE);
}

void GLAPIENTRY
gluPickMatrix(double x, double y, double deltax, double deltay,
          int viewport[4])
{
    if (deltax <= 0 || deltay <= 0) {
    return;
    }

    /* Translate and scale the picked region to the entire window */
    glTranslatef((viewport[2] - 2 * (x - viewport[0])) / deltax,
        (viewport[3] - 2 * (y - viewport[1])) / deltay, 0);
    glScalef(viewport[2] / deltax, viewport[3] / deltay, 1.0);
}

#endif


#endif

